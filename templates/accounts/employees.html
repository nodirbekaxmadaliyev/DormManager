{% extends 'base.html' %}
{% block content %}
<div class="container mt-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-center flex-grow-1">Xodimlar</h2>
        <div>
            <a href="{% url 'employee_add' %}" class="btn btn-success">Qo'shish</a>
            <button id="export-btn" class="btn btn-primary">Yuklash</button>
        </div>
    </div>
</div>

<form id="search-form">
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Ismi</th>
                    <th>Familiyasi</th>
                    <th>Ish joyi</th>
                    <th>Tahrirlash</th>
                </tr>
                <tr>
                    <td><input type="text" name="first_name" class="form-control search-input" placeholder="Ismi"></td>
                    <td><input type="text" name="last_name" class="form-control search-input" placeholder="Familiyasi"></td>
                    <td><input type="text" name="dormitory_name" class="form-control search-input" placeholder="Ish joyi"></td>
                    <td></td>
                </tr>
            </thead>
            <tbody>
                {% for employee in object_list %}
                <tr>
                    <td>{{ employee.user.first_name }}</td>
                    <td>{{ employee.user.last_name }}</td>
                    <td>{{ employee.dormitory.name }}</td>
                    <td><a href="{% url 'employee_update' employee.user.pk %}" class="btn btn-sm btn-success">Tahrirlash</a></td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center">Hech qanday natija topilmadi</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</form>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    // Filtrlar oâ€˜zgarganda ma'lumotlarni AJAX orqali yangilash
    $(".search-input, .search-select").on("keyup change", function() {
        let formData = $("#search-form").serialize();

        $.ajax({
            url: "{% url 'employees' %}",
            type: "GET",
            data: formData,
            headers: {
                "X-Requested-With": "XMLHttpRequest"
            },
            success: function(data) {
                $("tbody").html($(data).find("tbody").html());
            },
            error: function(xhr, status, error) {
                console.log("Xatolik:", error);
            }
        });
    });

    // Yuklash tugmasi bosilganda eksport qilish
    $("#export-btn").on("click", function() {
        const params = $("#search-form").serialize();
        const url = `{% url 'employees' %}?${params}&export=excel`;
        window.location.href = url;
    });
});
</script>

<style>
@media (max-width: 768px) {
    .table-responsive {
        width: 100%;
        margin-bottom: 15px;
        overflow-y: hidden;
        border: 1px solid #ddd;
    }

    .table-responsive > .table {
        margin-bottom: 0;
    }

    .table-responsive > .table > thead > tr > th,
    .table-responsive > .table > tbody > tr > td {
        white-space: nowrap;
        padding: 8px;
    }

    .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
    }

    .form-control, .form-select {
        padding: 0.375rem 0.75rem;
        font-size: 0.875rem;
    }
}
</style>
{% endblock content %}
